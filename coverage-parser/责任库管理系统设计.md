# è´£ä»»åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

å»ºç«‹ä¸€ä¸ªç®¡ç†å‘˜çš„è´£ä»»åº“ï¼Œç”¨äºæŸ¥çœ‹å’Œç®¡ç†å·²è§£æçš„ä¿é™©è´£ä»»ï¼Œæ”¯æŒï¼š
- æŸ¥çœ‹æ‰€æœ‰è§£æçš„è´£ä»»æ•°æ®
- ç­›é€‰ã€æœç´¢ã€æ’åº
- æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ‰€æœ‰JSONè§£æå†…å®¹ï¼‰
- å¯¼å‡ºæ•°æ®

## ğŸ—‚ï¸ æ•°æ®ç»“æ„è®¾è®¡

### 1. æ•°æ®åº“æ‰©å±•ï¼ˆPrisma Schemaï¼‰

åœ¨ç°æœ‰çš„ `InsuranceCoverageLibrary` åŸºç¡€ä¸Šï¼Œéœ€è¦ç¡®ä¿åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```prisma
model InsuranceCoverageLibrary {
  id                  Int       @id @default(autoincrement())
  
  // åŸºç¡€ä¿¡æ¯
  åºå·                Int?      // ä»è§£æç»“æœå¯¼å…¥çš„åºå·
  ä¿å•IDå·            String?   // ä¿å•IDå·
  è´£ä»»ç±»å‹            String    // ç–¾ç—…ç±»/èº«æ•…ç±»ç­‰
  è´£ä»»åç§°            String
  
  // åŸæ–‡å’Œè§£æ
  è´£ä»»åŸæ–‡            String    @db.Text
  parsedResult        Json?     // å®Œæ•´çš„è§£æç»“æœJSON
  
  // ä»parsedResultä¸­æå–çš„å…³é”®å­—æ®µï¼ˆä¾¿äºæŸ¥è¯¢ï¼‰
  naturalLanguageDesc Json?     // æ‰€æœ‰é˜¶æ®µçš„naturalLanguageDescriptionæ•°ç»„
  payoutAmount        Json?     // payoutAmountæ•°ç»„
  note                String?   // noteå­—æ®µ
  
  // è§£æçš„å­—æ®µï¼ˆä»noteå’ŒparsedResultä¸­æå–ï¼‰
  èµ”ä»˜æ¬¡æ•°            String?   // "ç»™ä»˜ä»¥1æ¬¡ä¸ºé™" / "ç´¯è®¡æœ€å¤šèµ”3æ¬¡"
  æ˜¯å¦å¯ä»¥é‡å¤èµ”ä»˜    Boolean?  // ä»èµ”ä»˜æ¬¡æ•°æ¨æ–­
  æ˜¯å¦åˆ†ç»„            Boolean?  // ä»noteä¸­æå–"éœ€å±äºä¸åŒç»„åˆ«"
  é—´éš”æœŸ              String?   // "éœ€é—´éš”180æ—¥" / "éœ€é—´éš”1å¹´"
  æ˜¯å¦è±å…            Boolean?  // ä»noteä¸­æå–"è±å…"å…³é”®è¯
  
  // å…³è”äº§å“
  productId           Int
  product             InsuranceProduct @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  // å…¶ä»–ç°æœ‰å­—æ®µ...
  coverageType        String
  diseaseCategory     String?
  clauseText          String    @db.Text
  parseMethod         String    @default("llm")
  confidenceScore     Float?
  verified            Boolean   @default(false)
  verifiedBy          String?
  verifiedAt          DateTime?
  isTrainingSample    Boolean   @default(false)
  annotationQuality   String?
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  @@index([åºå·])
  @@index([ä¿å•IDå·])
  @@index([è´£ä»»ç±»å‹])
  @@index([æ˜¯å¦å¯ä»¥é‡å¤èµ”ä»˜])
  @@index([æ˜¯å¦åˆ†ç»„])
  @@index([æ˜¯å¦è±å…])
  @@map("insurance_coverage_library")
}
```

## ğŸ¨ UIè®¾è®¡

### 1. é¡µé¢å…¥å£

**å»ºè®®ä½ç½®**ï¼šåœ¨ `PolicyManagerHomePage` çš„å¯¼èˆªæ ä¸­æ·»åŠ "è´£ä»»åº“"å…¥å£

```tsx
// åœ¨PolicyManagerHomePage.tsxçš„å¯¼èˆªä¸­æ·»åŠ 
<Menu.Item key="coverage-library" onClick={() => navigate('/coverage-library')}>
  <DatabaseOutlined /> è´£ä»»åº“
</Menu.Item>
```

### 2. é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è´£ä»»åº“ç®¡ç†ç³»ç»Ÿ                    [å¯¼å…¥] [å¯¼å‡º] [åˆ·æ–°]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­›é€‰æ¡ä»¶:                                              â”‚
â”‚  [ä¿å•IDå·â–¼] [è´£ä»»ç±»å‹â–¼] [æ˜¯å¦åˆ†ç»„â–¼] [æ˜¯å¦è±å…â–¼] [æœç´¢]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»Ÿè®¡: æ€»è®¡ 3000 | å·²å®¡æ ¸ 1668 | æœªå®¡æ ¸ 1332            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åºå· â”‚ ä¿å•ID â”‚ è´£ä»»ç±»å‹ â”‚ è´£ä»»åç§° â”‚ èµ”ä»˜æ¬¡æ•° â”‚ æ“ä½œ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   1   â”‚ çˆ±å¿ƒ... â”‚ ç–¾ç—…ç±»  â”‚ ç½•è§ç–¾ç—… â”‚ 1æ¬¡      â”‚ æŸ¥çœ‹ â”‚
â”‚   2   â”‚ çˆ±å¿ƒ... â”‚ ç–¾ç—…ç±»  â”‚ ç¬¬äºŒæ¬¡ä¸­ç—‡â”‚ 1æ¬¡      â”‚ æŸ¥çœ‹ â”‚
â”‚  ...  â”‚  ...   â”‚  ...   â”‚  ...    â”‚  ...    â”‚ æŸ¥çœ‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. åˆ—è¡¨é¡µè®¾è®¡ï¼ˆCoverageLibraryPage.tsxï¼‰

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- è¡¨æ ¼å±•ç¤ºï¼ˆAnt Design Tableï¼‰
- ç­›é€‰å™¨ï¼ˆä¿å•IDã€è´£ä»»ç±»å‹ã€æ˜¯å¦åˆ†ç»„ã€æ˜¯å¦è±å…ã€æ˜¯å¦é‡å¤èµ”ä»˜ï¼‰
- æœç´¢ï¼ˆè´£ä»»åç§°ã€è´£ä»»åŸæ–‡ï¼‰
- åˆ†é¡µ
- è¯¦æƒ…å¼¹çª—

**è¡¨æ ¼åˆ—**ï¼š
1. åºå·
2. ä¿å•IDå·ï¼ˆå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼‰
3. è´£ä»»ç±»å‹
4. è´£ä»»åç§°
5. èµ”ä»˜æ¬¡æ•°ï¼ˆä»noteæå–ï¼‰
6. æ˜¯å¦é‡å¤èµ”ä»˜ï¼ˆæ ‡ç­¾ï¼‰
7. æ˜¯å¦åˆ†ç»„ï¼ˆæ ‡ç­¾ï¼‰
8. é—´éš”æœŸï¼ˆå¦‚æœ‰ï¼‰
9. æ˜¯å¦è±å…ï¼ˆæ ‡ç­¾ï¼‰
10. å®¡æ ¸çŠ¶æ€ï¼ˆæ ‡ç­¾ï¼‰
11. æ“ä½œï¼ˆæŸ¥çœ‹è¯¦æƒ…ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰

### 4. è¯¦æƒ…å¼¹çª—è®¾è®¡

**å±•ç¤ºå†…å®¹**ï¼š
- åŸºç¡€ä¿¡æ¯å¡ç‰‡
- è´£ä»»åŸæ–‡ï¼ˆå¯å±•å¼€/æ”¶èµ·ï¼‰
- è‡ªç„¶è¯­è¨€æè¿°ï¼ˆæ‰€æœ‰é˜¶æ®µï¼‰
- ç†èµ”é‡‘é¢è¯¦æƒ…ï¼ˆJSONæ ¼å¼åŒ–å±•ç¤ºï¼‰
- å®Œæ•´è§£æç»“æœï¼ˆå¯æŠ˜å çš„JSONæŸ¥çœ‹å™¨ï¼‰

## ğŸ”§ åç«¯APIè®¾è®¡

### 1. æŸ¥è¯¢è´£ä»»åˆ—è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ‰©å±•ï¼‰

```typescript
// GET /api/coverage-library
// æŸ¥è¯¢å‚æ•°ï¼š
// - page: é¡µç 
// - pageSize: æ¯é¡µæ•°é‡
// - ä¿å•IDå·: æ¨¡ç³Šæœç´¢
// - è´£ä»»ç±»å‹: ç²¾ç¡®åŒ¹é…
// - è´£ä»»åç§°: æ¨¡ç³Šæœç´¢
// - æ˜¯å¦å¯ä»¥é‡å¤èµ”ä»˜: boolean
// - æ˜¯å¦åˆ†ç»„: boolean
// - æ˜¯å¦è±å…: boolean
// - æ˜¯å¦å·²å®¡æ ¸: boolean
// - sortBy: æ’åºå­—æ®µï¼ˆåºå·/åˆ›å»ºæ—¶é—´/ä¿å•IDï¼‰
// - sortOrder: asc/desc
```

### 2. å¯¼å…¥è§£æç»“æœ

```typescript
// POST /api/coverage-library/import
// ä»è§£æç»“æœJSONæ–‡ä»¶å¯¼å…¥æ•°æ®
// è‡ªåŠ¨æå–å…³é”®å­—æ®µå¹¶å¡«å……åˆ°æ•°æ®åº“
```

### 3. å¯¼å‡ºæ•°æ®

```typescript
// GET /api/coverage-library/export
// å¯¼å‡ºä¸ºExcelæˆ–CSV
// åŒ…å«æ‰€æœ‰å­—æ®µ
```

### 4. è·å–è¯¦æƒ…ï¼ˆå·²å­˜åœ¨ï¼‰

```typescript
// GET /api/coverage-library/:id
// è¿”å›å®Œæ•´çš„è´£ä»»ä¿¡æ¯ï¼ŒåŒ…æ‹¬parsedResult
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
coverage-parser/
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ routes/
â”‚       â”‚   â””â”€â”€ coverageLibraryRouter.ts (æ‰©å±•)
â”‚       â””â”€â”€ services/
â”‚           â””â”€â”€ parser/
â”‚               â””â”€â”€ storage/
â”‚                   â””â”€â”€ coverageLibraryStorage.ts (æ‰©å±•)
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ src/
        â”œâ”€â”€ pages/
        â”‚   â””â”€â”€ CoverageLibraryPage.tsx (æ–°å»º)
        â”œâ”€â”€ components/
        â”‚   â”œâ”€â”€ CoverageLibraryTable.tsx (æ–°å»º)
        â”‚   â”œâ”€â”€ CoverageDetailModal.tsx (æ–°å»º)
        â”‚   â””â”€â”€ CoverageFilters.tsx (æ–°å»º)
        â””â”€â”€ services/
            â””â”€â”€ api.ts (æ‰©å±•)
```

## ğŸš€ å®ç°æ­¥éª¤

### Phase 1: åç«¯æ‰©å±•
1. æ‰©å±• Prisma Schemaï¼ˆæ·»åŠ æ–°å­—æ®µå’Œç´¢å¼•ï¼‰
2. åˆ›å»ºæ•°æ®åº“è¿ç§»
3. æ‰©å±• coverageLibraryStorage æœåŠ¡
4. æ‰©å±• coverageLibraryRouter API

### Phase 2: æ•°æ®å¯¼å…¥
1. åˆ›å»ºå¯¼å…¥è„šæœ¬ï¼Œä»è§£æç»“æœJSONå¯¼å…¥æ•°æ®
2. è‡ªåŠ¨æå–å…³é”®å­—æ®µï¼ˆèµ”ä»˜æ¬¡æ•°ã€æ˜¯å¦åˆ†ç»„ç­‰ï¼‰

### Phase 3: å‰ç«¯å®ç°
1. åˆ›å»º CoverageLibraryPage é¡µé¢
2. åˆ›å»ºè¡¨æ ¼ç»„ä»¶
3. åˆ›å»ºç­›é€‰å™¨ç»„ä»¶
4. åˆ›å»ºè¯¦æƒ…å¼¹çª—ç»„ä»¶
5. æ·»åŠ è·¯ç”±

### Phase 4: åŠŸèƒ½å®Œå–„
1. æœç´¢åŠŸèƒ½
2. å¯¼å‡ºåŠŸèƒ½
3. æ‰¹é‡æ“ä½œ
4. å®¡æ ¸åŠŸèƒ½

## ğŸ“Š æ•°æ®æå–é€»è¾‘

### ä»noteå­—æ®µæå–ä¿¡æ¯ï¼š

```typescript
function extractCoverageInfo(note: string, parsedResult: any) {
  const info = {
    èµ”ä»˜æ¬¡æ•°: null,
    æ˜¯å¦å¯ä»¥é‡å¤èµ”ä»˜: null,
    æ˜¯å¦åˆ†ç»„: false,
    é—´éš”æœŸ: null,
    æ˜¯å¦è±å…: false
  };
  
  if (!note) return info;
  
  // æå–èµ”ä»˜æ¬¡æ•°
  const countMatch = note.match(/ç»™ä»˜ä»¥(\d+)æ¬¡ä¸ºé™|ç´¯è®¡æœ€å¤šèµ”(\d+)æ¬¡|æ¯ç§.*é™èµ”(\d+)æ¬¡/);
  if (countMatch) {
    const count = parseInt(countMatch[1] || countMatch[2] || countMatch[3]);
    info.èµ”ä»˜æ¬¡æ•° = count === 1 ? '1æ¬¡' : `æœ€å¤š${count}æ¬¡`;
    info.æ˜¯å¦å¯ä»¥é‡å¤èµ”ä»˜ = count > 1;
  }
  
  // æå–åˆ†ç»„ä¿¡æ¯
  info.æ˜¯å¦åˆ†ç»„ = note.includes('ç»„åˆ«') || note.includes('åˆ†ç»„');
  
  // æå–é—´éš”æœŸ
  const intervalMatch = note.match(/éœ€é—´éš”(\d+)(æ—¥|å¤©|å¹´|æœˆ)/);
  if (intervalMatch) {
    info.é—´éš”æœŸ = `é—´éš”${intervalMatch[1]}${intervalMatch[2]}`;
  }
  
  // æå–è±å…ä¿¡æ¯
  info.æ˜¯å¦è±å… = note.includes('è±å…');
  
  return info;
}
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. ç¡®è®¤è®¾è®¡æ–¹æ¡ˆ
2. åˆ›å»ºæ•°æ®åº“è¿ç§»
3. å®ç°åç«¯API
4. å®ç°å‰ç«¯é¡µé¢
5. æµ‹è¯•å’Œä¼˜åŒ–

