# 保险条款数据标注规则库（统一版）

**版本**: v3.0 ⭐️⭐️⭐️  
**更新日期**: 2026-01-27  
**重大更新**: 
- **v3.0新增**: payoutStructure结构（持续给付责任统一使用，取代continuousPayment分阶段方式）；明确"整个解析只有一个note"原则（案例级别）；字段内部禁止note（除必要的补充说明如survivalPeriod.note、ageConditions.note）
- 废弃字母变量（N/M），改用中文术语
- 统一waitingPeriodStatus规则（保留'during'）
- 整合三个规则文档为一个
- **v2.1新增**: formulaVariables使用规范、已交保费统一、等待期默认值、复杂公式规范、质量检查清单
- **v2.2新增**: 年龄条件否定表述处理规范、年龄操作符反向规则、重复条件避免规则
- **v2.3新增**: 年龄条件提取详细规则表、特殊表述处理规范、投保时vs确诊时判断规则
- **v2.4新增**: 年龄条件字段标准化规范、废弃旧字段名（ageType/age）、禁止range操作符
- **v2.5新增**: 投保时vs确诊时核心判断原则（必须有"投保"关键词）、详细案例对比、检查清单
- **v2.6新增**: 常见错误与易错点汇总（6大类错误）、份数变量处理、增幅限额公式规范
- **v2.7新增**: 持续给付字段规范（continuousPayment）、固定次数vs直至终止两种类型、详细使用场景和检查清单
- **v2.8新增**: 简化continuousPayment结构（删除enabled和description字段，保留frequency明确给付频率）
- **v2.9新增**: 赔付次数限制识别规则扩展（从"本合同终止"/"责任终止"推断赔付1次）⭐️ 重要；naturalLanguageDescription完整性要求；中文百分比识别规范

---

## 📋 目录

1. [字段定义规范](#1-字段定义规范)
2. [公式格式规范](#2-公式格式规范)
3. [标准术语表](#3-标准术语表)
4. [阶段拆分规则](#4-阶段拆分规则)
5. [等待期处理规则](#5-等待期处理规则)
6. [年龄条件规范](#6-年龄条件规范)
7. [保单年度范围规范](#7-保单年度范围规范)
8. [交费期状态规范](#8-交费期状态规范)
9. [Note字段规范](#9-note字段规范)
10. [持续给付规范](#10-持续给付规范) ⭐️ 新增
11. [复杂公式规范](#11-复杂公式规范)
12. [完整示例](#12-完整示例)
13. [质量检查清单](#13-质量检查清单)
14. [常见错误与易错点](#14-常见错误与易错点)

---

## 1. 字段定义规范

### 1.1 案例结构

```typescript
interface Case {
  序号: number;                    // 案例编号
  保单ID号: string;                // 保单条款编号
  责任类型: string;                // 如：疾病类、身故类
  责任名称: string;                // 保险责任名称
  责任原文: string;                // 原始条款文本
  payoutAmount: PayoutTier[];      // 赔付金额数组
  note?: string;                   // 案例级别的备注（可选）
}
```

### 1.2 赔付阶段字段（PayoutTier）

```typescript
interface PayoutTier {
  // ====== 必填字段 ======
  stageNumber: number;             // 阶段编号（必填）
  waitingPeriodStatus: 'during' | 'after';  // 等待期状态（必填）
  naturalLanguageDescription: string;  // 自然语言描述（必填）⭐️
  
  // ====== 赔付结构（二选一）======
  formula?: string;                // 普通一次性赔付公式
  payoutStructure?: {              // 持续给付责任结构 ⭐️ 新增
    firstPayout: {
      formula: string;             // 首次给付公式
      timing?: string;             // 首次给付时机（如"首次确诊"）
    };
    subsequentPayout: {
      formula: string;             // 后续给付公式
      frequency: string;           // 给付频率（如"每年对应日"）
    };
    cumulativeLimit: {
      formula: string;             // 累计给付封顶公式
    };
  };
  
  // ====== 可选字段 ======
  formulaVariables?: string;       // 公式变量说明（仅在特殊情况下使用）
  
  // ====== 6个维度（可选）======
  ageConditions?: AgeCondition[];  // 年龄条件数组
  
  policyYearRange?: {              // 保单年度范围
    start: number | null;          // 起始年度（null表示从第1年）
    end: number | null;            // 结束年度（null表示到保障结束）
  };
  
  paymentPeriodStatus?: 'during' | 'after';  // 交费期状态
  
  paymentMode?: 'lumpSum' | 'installment';  // 交费方式
  
  coveragePeriodConditions?: string[];  // 保障期间条件
  
  continuousPayment?: {            // 持续给付（已废弃，使用payoutStructure代替）
    type: 'fixed_count' | 'until_termination';  // 给付类型
    totalCount?: number;           // 总给付次数（仅fixed_count时需要）
    frequency: string;             // 给付频率（如"每年"、"每年对应日"）
  };
}
```

### 1.3 年龄条件结构

```typescript
interface AgeCondition {
  limit: number;                    // 年龄界限
  operator: '<' | '>' | '<=' | '>='; // 比较运算符
  type: '投保时' | '确诊时';         // 年龄判断的时间点
  gender?: '男' | '女';             // 性别限定（可选）⭐️ 新增
}
```

**gender字段说明**：
- 当原文明确区分男女年龄时使用（如"男：60周岁，女：55周岁"）
- 如果男女年龄相同，不需要填写此字段
- 通常需要拆分为多个阶段，每个阶段对应不同性别

### 1.4 自然语言描述规范（naturalLanguageDescription）⭐️ 重要

**位置**：每个 PayoutTier 阶段必填

**作用**：用一句话全面描述该阶段的所有条件维度和赔付公式

**格式规范**：

```
"naturalLanguageDescription": "{维度1}、{维度2}、...、{公式描述}"
```

**维度包含顺序**（按以下顺序组合，有则加上，无则跳过）：
1. 等待期状态（"等待期内" / "等待期后" / 省略）
2. 年龄条件（如"18周岁前" / "60周岁及以上"）
3. 保单年度范围（如"第1-5保单年度" / "第11保单年度起"）
4. 交费期状态（如"交费期内" / "交费期满后"）
5. 其他特殊条件
6. **持续给付信息**（如"分3次给付" / "持续给付至合同终止"）⭐️ 重要
7. 赔付公式描述（如"按基本保额的50%赔付"）

**示例**：

```json
// 简单案例 - 只有等待期
{
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 100%",
  "naturalLanguageDescription": "等待期后确诊，按基本保额的100%赔付"
}

// 复杂案例 - 多个维度
{
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 50%",
  "ageConditions": [{"type": "确诊时", "limit": 18, "operator": "<"}],
  "naturalLanguageDescription": "等待期后、18周岁前确诊，按基本保额的50%赔付"
}

// 保单年度递增
{
  "waitingPeriodStatus": "after",
  "formula": "Min(基本保额 * 保单年度数, 基本保额 * 20)",
  "policyYearRange": {"start": 1, "end": null},
  "naturalLanguageDescription": "等待期后、保单年度递增，按基本保额×保单年度数赔付（上限20倍）"
}

// 持续给付（固定次数）
{
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 30%",
  "ageConditions": [{"type": "确诊时", "limit": 60, "operator": ">="}],
  "continuousPayment": {
    "type": "fixed_count",
    "totalCount": 3,
    "frequency": "每年对应日"
  },
  "naturalLanguageDescription": "等待期后、60周岁及以上确诊，每年按基本保额的30%赔付（分3次）"
}

// 持续给付（直至终止）
{
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 20%",
  "continuousPayment": {
    "type": "until_termination",
    "frequency": "每年对应日"
  },
  "naturalLanguageDescription": "等待期后确诊，每年按基本保额的20%持续给付至合同终止"
}
```

**注意事项**：
- ✅ **必须包含所有该阶段的条件维度**⭐️ 重要：
  - 等待期状态（waitingPeriodStatus）→ "等待期内" / "等待期后"
  - 年龄条件（ageConditions）→ "18周岁前" / "60周岁及以上"
  - 保单年度（policyYearRange）→ "第1-5保单年度" / "第11保单年度起"
  - 交费期状态（paymentPeriodStatus）→ "交费期内" / "交费期满后"
  - **持续给付（continuousPayment）→ "分3次" / "持续给付至合同终止"**⭐️ 必须体现
- ✅ 公式描述要清晰易懂（包含赔付比例，如"按基本保额的50%赔付"）
- ❌ 不要包含note中的内容（如赔付次数限制、间隔期、分组规则）
- ❌ 不要过于冗长，保持简洁

**完整性检查清单（双向检查）**：

**正向检查**（字段 → 描述）：
- [ ] 有waitingPeriodStatus → 描述中必须有"等待期内"或"等待期后"
- [ ] 有ageConditions → 描述中必须有年龄条件（如"18周岁前"）
- [ ] 有policyYearRange → 描述中必须有保单年度信息
- [ ] 有paymentPeriodStatus → 描述中必须有交费期信息（如"交费期内"）
- [ ] **有continuousPayment → 描述中必须体现持续给付信息**⭐️ 重要
- [ ] formula中有百分比 → 描述中必须包含赔付比例

**反向检查**（描述 → 字段）⭐️ **非常重要**：
- [ ] 描述提到"投保年龄"或"投保时" → 必须有ageConditions且type='投保时'
- [ ] 描述提到年龄（如"51周岁"） → 必须有ageConditions字段
- [ ] 描述提到保单年度（如"第1-10年"） → 必须有policyYearRange字段
- [ ] 描述提到交费期 → 必须有paymentPeriodStatus字段
- [ ] 描述提到"分X次"或"持续给付" → 必须有continuousPayment字段
- [ ] 描述提到"等待期内" → waitingPeriodStatus必须='during'
- [ ] 描述提到"等待期后" → waitingPeriodStatus必须='after'
- [ ] 描述中的比例 → formula中的比例必须一致（避免20.0% vs 20%）

---

## 2. 公式格式规范

### 2.1 核心原则⭐️ 重要

**使用中文术语，不使用字母变量（N/M/P/R等）**

✅ **正确格式**：
```
"formula": "基本保额 * 100%"
"formula": "基本保额 * 30%"
"formula": "已交保费"
"formula": "基本保额 * 保单年度数"
"formula": "Min(基本保额 * 保单年度数, 基本保额 * 20)"
"formula": "Max(基本保额, 现金价值)"
```

❌ **错误格式**（已废弃）：
```
"formula": "基本保额 * N%"          // 不使用字母变量
"formula": "基本保额×50%"          // 使用错误的运算符
"formula": "保险金额"              // 使用非标准术语
```

### 2.2 运算符规范

- **乘法**: 统一使用 `*`，不使用 `×`
- **加减**: 使用 `+` `-`
- **括号**: 使用英文括号 `()`
- **函数**: `Min()` `Max()`

### 2.3 中文百分比识别规范 ⭐️ 新增

**核心原则**：原文中的中文百分比表述必须转换为阿拉伯数字百分比

**常见中文百分比表述**：

| 原文表述 | 转换后 | 示例 |
|---------|--------|------|
| 百分之二十 | 20% | `基本保额 * 20%` |
| 百分之三十 | 30% | `基本保额 * 30%` |
| 百分之五十 | 50% | `基本保额 * 50%` |
| 百分之八十 | 80% | `基本保额 * 80%` |
| 百分之百 | 100% | `基本保额 * 100%` |

**中文数字映射**：

| 中文数字 | 阿拉伯数字 | 示例 |
|---------|-----------|------|
| 一、二、三...九 | 1、2、3...9 | 百分之三 → 3% |
| 十、二十、三十...九十 | 10、20、30...90 | 百分之二十 → 20% |
| 一百 | 100 | 百分之百 → 100% |

**识别规则**：
1. ✅ 识别"百分之X"格式（如"百分之二十"）
2. ✅ 识别"X百分之"格式（较少见）
3. ✅ 识别全角百分号"％"（如"二十％"）
4. ✅ 必须转换为阿拉伯数字百分比（如"20%"）

**典型案例**：

✅ **案例1**：
```
原文：按本合同的基本保险金额的百分之二十，给付特定重大疾病保险金
formula: "基本保额 * 20%"
```

✅ **案例2**：
```
原文：重大疾病保险金的金额等于本附加合同保险金额的百分之三十
formula: "基本保额 * 30%"
```

**检查要点**：
- [ ] 原文包含"百分之X"时，formula中必须有对应的百分比
- [ ] 中文数字必须正确转换为阿拉伯数字
- [ ] 不要遗漏任何中文百分比表述

---

## 3. 标准术语表⭐️ 核心

详见《标准术语表.md》

### 3.1 保额类术语

| 标准术语 | 说明 | 示例 |
|---------|------|------|
| 基本保额 | 投保时约定的基本保险金额 | `基本保额 * 100%` |
| 有效保额 | 带增长率的保险金额 | `有效保额` |
| 确诊当年度保额 | 根据确诊年度变化的保额 | `确诊当年度保额` |
| 现金价值 | 保单的现金价值 | `Max(基本保额, 现金价值)` |

### 3.2 保费类术语

| 标准术语 | 说明 | 示例 |
|---------|------|------|
| 已交保费 | 累计已支付的保险费 | `已交保费` |
| 年交保费 | 每年支付的保险费 | `年交保费 * 20` |

### 3.3 动态变量术语⭐️ 重要

| 标准术语 | 数据来源字段 | 说明 | 示例 |
|---------|-------------|------|------|
| 保单年度数 | policyYearRange | 从保单生效起的年数（1, 2, 3...） | `基本保额 * 保单年度数` |
| 交费年度数 | paymentPeriodStatus | 已交费的年数 | `基本保额 * 交费年度数 * 105%` |
| 确诊年龄 | ageConditions | 确诊时被保险人的年龄 | `基本保额 * (200% - 确诊年龄 * 1%)` |
| 投保年龄 | ageConditions | 投保时被保险人的年龄 | `基本保额 * (150% - 投保年龄 * 0.5%)` |

**重要说明**：
- 这些动态变量的具体数值由后端根据配套字段动态计算
- 例如："保单年度数"从 `policyYearRange` 和当前日期计算得出

### 3.4 占位术语（用于"见下表"情况）

当原文说"见下表"、"按表确定"等，具体数值不确定时：

| 占位术语 | 使用场景 | 示例 |
|---------|---------|------|
| 给付比例 | 比例不确定时 | `基本保额 * 给付比例` |
| 赔付比例 | 比例不确定时（同给付比例） | `基本保额 * 赔付比例` |
| 递增比例 | 比例递增但具体值不确定 | `基本保额 * 递增比例` |
| 年度给付比例 | 按保单年度确定但值不确定 | `基本保额 * 年度给付比例` |

**使用场景**：
1. ✅ 原文说"见下表"、"按表确定"、"见合同附表"
2. ✅ 原文说"给付比例"但未给出具体数值
3. ✅ 原文说"不高于X%"（这是上限，不是具体给付比例）
4. ✅ 原文说给付比例根据某些条件动态计算

**formulaVariables 字段使用规范** ⭐️ 重要

`formulaVariables` 字段**仅在使用占位术语时必须添加**，用于说明占位术语的含义：

```json
{
  "formula": "基本保额 * 给付比例",
  "formulaVariables": "给付比例根据保单年度确定，具体见合同附表"
}
```

**✅ 需要 formulaVariables 的情况**：
- 使用了占位术语（给付比例、赔付比例等）
- 原文说"见下表"但没有具体比例
- 原文说给付比例是动态计算的
- 原文说"不高于X%"（上限限制）

**❌ 不需要 formulaVariables 的情况**：
- 公式使用了标准中文术语（如"保单年度数"）
- 公式是具体的百分比（如"基本保额 * 30%"）
- 公式很清晰，不需要额外说明

### 3.5 保费术语统一规范 ⭐️ 重要

**核心规则**：无论原文使用"退还"还是"给付"，统一在 `formula` 中使用 `已交保费`

| 原文表述 | 统一为 | 说明 |
|---------|--------|------|
| 退还已交保险费 | `已交保费` | 从理赔金额角度，效果相同 |
| 给付已交保费 | `已交保费` | 统一标注便于后端处理 |
| 无息退还本合同的已交保险费 | `已交保费` | 忽略"无息"描述 |
| 按本合同已经交付的保险费给付 | `已交保费` | 统一为标准术语 |
| 退还该被保险人的保险费 | `已交保费` | 明确指已交保费 |

**示例**：
```json
{
  "period": "等待期内",
  "waitingPeriodStatus": "during",
  "formula": "已交保费"
}
```

---

## 4. 阶段拆分规则

### 4.1 核心原则

**必须拆分的情况**：
1. ✅ 等待期内和等待期后的赔付不同
2. ✅ 不同年龄段的赔付比例不同
3. ✅ 不同保单年度的赔付比例不同
4. ✅ 赔付比例随次数递增（**且原文明确每次比例**）

**不需拆分的情况**：
1. ❌ 仅有单一赔付条件
2. ❌ 原文未明确不同阶段的具体赔付比例
3. ❌ 多次赔付但每次比例相同（用note说明）
4. ❌ **赔付金额相同但合同状态不同**（合并为一个阶段，在note中说明差异）⭐️ 新增

### 4.2 赔付次数的处理⭐️ 重要

**核心规则**：
- 如果是**治愈后再次确诊**，不在公式体现，在note中说明
- 如果是**持续性给付**（如每月给付N次），才在公式体现

**示例1：多次赔付（治愈后再确诊）** - ✅ 不拆分
```json
{
  "stageNumber": 1,
  "formula": "基本保额 * 30%",
  "note": "每种轻症限赔1次；累计最多赔3次"
}
```

**示例2：比例递增（原文明确每次比例）** - ✅ 需拆分
```json
[
  {
    "stageNumber": 1,
    "period": "首次确诊",
    "formula": "基本保额 * 30%",
    "note": "第1次赔付"
  },
  {
    "stageNumber": 2,
    "period": "第2次确诊",
    "formula": "基本保额 * 40%",
    "note": "第2次赔付"
  },
  {
    "stageNumber": 3,
    "period": "第3次确诊",
    "formula": "基本保额 * 50%",
    "note": "第3次赔付；累计最多赔3次"
  }
]
```

**示例3：持续性给付** - ✅ 在公式体现
```json
{
  "formula": "基本保额 * 0.5% * 10",
  "formulaVariables": "确诊后每月给付基本保额的0.5%，持续10个月",
  "note": "持续性给付"
}
```

---

## 5. 等待期处理规则⭐️ 重要

### 5.1 waitingPeriodStatus 字段

```
'during' - 等待期内（保留，记录完整信息）
'after'  - 等待期后（正常赔付）
```

**核心决策**：✅ **保留 'during'，记录完整信息**

### 5.2 处理规则

1. **等待期内不赔付或退还保费**:
   - ✅ 仍需创建该阶段
   - ✅ `waitingPeriodStatus: 'during'`
   - ✅ `formula: '已交保费'` 或 `formula: '0'`

2. **意外无等待期**:
   - ✅ 标注为 `waitingPeriodStatus: 'after'`
   - ✅ 在 `note` 中说明"因意外无等待期"

3. **等待期默认值处理** ⭐️ 重要:
   - 如果原文**没有明确提到**等待期相关描述，默认为 `waitingPeriodStatus: 'after'`
   - 判断标准：
     - ✅ 有明确描述（"等待期后"、"等待期内"、"生效之日起X日后"）→ 按原文标注
     - ✅ 没有等待期描述（"被保险人经专科医生确诊..."）→ 默认为"等待期后"
     - ✅ 只提到意外（"因意外伤害..."）→ 标注为"等待期后"

4. **后端过滤**:
   - 后端可根据需求过滤 'during' 阶段
   - AI解析保持数据完整性

### 5.3 示例

```json
{
  "payoutAmount": [
    {
      "stageNumber": 1,
      "period": "等待期内",
      "waitingPeriodStatus": "during",
      "formula": "已交保费"
    },
    {
      "stageNumber": 2,
      "period": "等待期后",
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 100%"
    }
  ]
}
```

---

## 6. 年龄条件规范

### 6.1 数据结构⭐️ 重要

```typescript
ageConditions?: AgeCondition[];  // 数组格式，支持年龄区间

interface AgeCondition {
  limit: number;                    // 年龄界限（必填）
  operator: '<' | '>' | '<=' | '>='; // 比较运算符（必填）
  type: '投保时' | '确诊时';         // 年龄判断的时间点（必填）
}
```

**⚠️ 字段名标准化**：

| ✅ 正确字段名 | ❌ 废弃字段名 | 说明 |
|-------------|-------------|------|
| `limit` | `age` | 年龄数值 |
| `type` | `ageType` | 时间点类型 |
| `operator` | - | 比较运算符 |

**禁止使用**：
- ❌ 不要使用 `ageType` 字段（已废弃）
- ❌ 不要使用 `age` 字段（已废弃）
- ❌ 不要使用 `operator: 'range'`（应拆分为两个独立条件）

### 6.2 常见场景

**单一年龄条件**：
```json
{
  "ageConditions": [
    {
      "limit": 60,
      "operator": "<",
      "type": "确诊时"
    }
  ]
}
```

**年龄区间**（如18-61周岁）：
```json
{
  "ageConditions": [
    {
      "limit": 18,
      "operator": ">=",
      "type": "确诊时"
    },
    {
      "limit": 61,
      "operator": "<",
      "type": "确诊时"
    }
  ]
}
```

**男女年龄不同，但赔付相同**（共享阶段）：
```json
{
  "stageNumber": 1,
  "formula": "基本保额 * 30%",
  "ageConditions": [
    {
      "limit": 60,
      "operator": ">=",
      "type": "确诊时",
      "gender": "男"
    },
    {
      "limit": 55,
      "operator": ">=",
      "type": "确诊时",
      "gender": "女"
    }
  ],
  "naturalLanguageDescription": "等待期后、男性60周岁及以上或女性55周岁及以上确诊，按基本保额的30%赔付"
}
```

### 6.3 type 字段说明

- `投保时`: 年龄条件基于投保时的年龄判断
- `确诊时`: 年龄条件基于确诊时的年龄判断

### 6.4 性别字段说明⭐️ 新增

**使用场景**：当原文明确区分男女不同年龄时

**原文特征**：
- "男：60周岁，女：55周岁"
- "被保险人为男性且...18周岁后"
- "若被保险人为女性...60周岁前"

**处理方法（重要）**：⭐️

**核心原则**：
- ✅ **赔付金额相同** → 共享阶段，在同一阶段的 `ageConditions` 数组中放入多个条件
- ✅ **赔付金额不同** → 必须拆分为不同阶段

**为什么这样设计？**
1. 避免阶段爆炸（4个阶段 → 8个阶段）
2. 保持数据完整性（记录所有性别的年龄条件）
3. 便于大模型理解和生成
4. 后端可根据性别和年龄灵活匹配

**示例1：赔付相同，共享阶段**（推荐）⭐️

原文：
> "被保险人年满合同规定年龄（男：60周岁，女：55周岁）后...每次给付金额为该被保险人的基本保险金额的30%"

**分析**：男女赔付金额相同（都是30%），可以共享阶段

正确标注（共享阶段）：
```json
{
  "序号": 1933,
  "责任名称": "重大疾病康复保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 30%",
      "ageConditions": [
        {
          "type": "确诊时",
          "limit": 60,
          "operator": ">=",
          "gender": "男"
        },
        {
          "type": "确诊时",
          "limit": 55,
          "operator": ">=",
          "gender": "女"
        }
      ],
      "continuousPayment": {
        "type": "fixed_count",
        "totalCount": 3,
        "frequency": "每年对应日"
      },
      "naturalLanguageDescription": "等待期后、男性60周岁及以上或女性55周岁及以上确诊，每年按基本保额的30%赔付（分3次）"
    }
  ],
  "note": "额外给付；需间隔180日"
}
```

**关键点**：
- ✅ 1个阶段包含2个年龄条件
- ✅ naturalLanguageDescription 使用"或"连接："男性60周岁及以上**或**女性55周岁及以上"
- ✅ 避免阶段爆炸

---

**示例2：赔付不同，必须拆分**

原文（假设）：
> "男性18-60周岁按100%给付，女性18-55周岁按120%给付"

**分析**：男女赔付金额不同（100% vs 120%），必须拆分阶段

正确标注（拆分阶段）：
```json
{
  "payoutAmount": [
    {
      "stageNumber": 1,
      "formula": "基本保额 * 100%",
      "ageConditions": [
        {"type": "确诊时", "limit": 18, "operator": ">=", "gender": "男"},
        {"type": "确诊时", "limit": 60, "operator": "<", "gender": "男"}
      ],
      "naturalLanguageDescription": "等待期后、男性18-60周岁确诊，按基本保额的100%赔付"
    },
    {
      "stageNumber": 2,
      "formula": "基本保额 * 120%",
      "ageConditions": [
        {"type": "确诊时", "limit": 18, "operator": ">=", "gender": "女"},
        {"type": "确诊时", "limit": 55, "operator": "<", "gender": "女"}
      ],
      "naturalLanguageDescription": "等待期后、女性18-55周岁确诊，按基本保额的120%赔付"
    }
  ]
}
```

**关键点**：
- ✅ 因为赔付不同，必须拆分为2个阶段
- ✅ 每个阶段对应一个性别和赔付金额

### 6.5 年龄条件提取规则⭐️ 重要

#### 6.5.1 常见表述与操作符对应

| 原文表述 | operator | 说明 | 示例 |
|---------|----------|------|------|
| 未满X周岁 | `<` | 严格小于 | 未满18周岁 → `< 18` |
| X周岁之前 | `<` | 严格小于 | 65周岁之前 → `< 65` |
| X周岁前 | `<` | 严格小于 | 年满75周岁前 → `< 75` |
| 不超过X周岁 | `<=` | 小于等于 | 不超过30周岁 → `<= 30` |
| 未超过X周岁（含） | `<=` | 小于等于 | 未超过30周岁（含） → `<= 30` |
| X周岁以上 | `>=` | 大于等于 | 18周岁以上 → `>= 18` |
| X周岁（含）之后 | `>=` | 大于等于 | 18周岁（含）之后 → `>= 18` |
| 满X周岁 | `>=` | 大于等于 | 满18周岁 → `>= 18` |

#### 6.4.2 特殊表述处理

**表述1：保单周年日相关**
- 原文："X周岁后的首个保单周年日以前"
- 理解：在X周岁前
- 提取：`{"limit": X, "operator": "<", "type": "确诊时"}`

**表述2：生效对应日相关**
- 原文："X周岁年生效对应日之前（不含当日）"
- 理解：在X周岁前
- 提取：`{"limit": X, "operator": "<", "type": "确诊时"}`

**表述3：包含"含"的模糊表述**
- 原文："X周岁（含）前"
- 理解：X周岁及之前
- 提取：`{"limit": X, "operator": "<=", "type": "确诊时"}`

#### 6.5.2 投保时 vs 确诊时⭐️ 非常重要

**核心判断原则**：
1. **必须有明确的"投保"关键词才能标注为"投保时"**
2. **没有"投保"关键词的，默认为"确诊时"**

**判断流程**：
```
原文是否包含"投保年龄"、"投保时"等关键词？
├─ 是 → type: '投保时'
└─ 否 → type: '确诊时'
```

**"投保时"的明确标志**：

| 原文表述 | type值 | 示例 |
|---------|--------|------|
| **投保年龄**为X周岁 | `投保时` | "投保年龄为18周岁以上" |
| **投保时**被保险人年龄 | `投保时` | "投保时被保险人的年龄小于18周岁" |
| 被保险人的**投保年龄** | `投保时` | "被保险人的投保年龄未满60周岁" |

**"确诊时"的典型表述**（⚠️ 不要误标为"投保时"）：

| 原文表述 | type值 | 说明 |
|---------|--------|------|
| 被保险人**年满**X周岁前 | `确诊时` | 没有"投保"关键词 |
| 被保险人**于**X周岁 | `确诊时` | 没有"投保"关键词 |
| **年满**X周岁的首个保单周年日 | `确诊时` | 没有"投保"关键词 |
| **在**X周岁...之前 | `确诊时` | 没有"投保"关键词 |
| 确诊时、初次确诊时、到达年龄 | `确诊时` | 明确指确诊时 |

**实际案例对比**：

✅ **正确 - 投保时**：
```json
// 原文："投保年龄为18周岁以上（含18周岁）"
{
  "ageConditions": [
    {
      "limit": 18,
      "operator": ">=",
      "type": "投保时"  // ✓ 有"投保年龄"关键词
    }
  ]
}
```

✅ **正确 - 确诊时**：
```json
// 原文："在被保险人年满30周岁后的首个保单周年日零时之前"
{
  "ageConditions": [
    {
      "limit": 30,
      "operator": "<",
      "type": "确诊时"  // ✓ 没有"投保"关键词，是确诊时的年龄限制
    }
  ]
}
```

❌ **错误示例**：
```json
// 原文："被保险人于51周岁的首个保单周年日之后确诊..."
{
  "ageConditions": [
    {
      "limit": 51,
      "operator": "<",
      "type": "投保时"  // ✗ 错误！原文没有"投保"关键词，应为"确诊时"
    }
  ]
}
```

**检查清单**：
- [ ] 标注为"投保时"时，原文必须包含"投保"关键词
- [ ] 没有"投保"关键词的，一律标注为"确诊时"
- [ ] 不要因为"保单周年日"、"生效对应日"等词语就误认为是"投保时"

### 6.6 否定表述的处理⭐️ 重要

**核心原则**：当原文使用"不承担责任"、"不给付"等否定表述时，需要**反向理解**年龄条件。

#### 6.6.1 否定表述识别

常见的否定表述关键词：
- "不承担...责任"
- "不给付"
- "不再给付"
- "我们将不承担"

#### 6.6.2 年龄操作符反向规则

| 原文否定表述 | 承担责任的年龄条件 | operator | 说明 |
|-------------|------------------|----------|------|
| X周岁**之后**不承担责任 | X周岁之前承担 | `<` | 严格小于 |
| X周岁**之后（含X周岁）**不承担责任 | X周岁之前承担 | `<` | 严格小于 |
| **未满**X周岁不承担责任 | 满X周岁及以上承担 | `>=` | 大于等于 |
| X周岁**之前**不承担责任 | X周岁及以上承担 | `>=` | 大于等于 |

#### 6.6.3 实际案例

**案例1：51周岁后不承担责任**

原文：
```
若被保险人于51周岁的首个保单周年日之后（含51周岁的首个保单周年日）确诊...
则我们不承担给付重大疾病关爱金的责任。
```

正确解析：
```json
{
  "ageConditions": [
    {
      "limit": 51,
      "operator": "<",  // 51周岁之前承担责任
      "type": "投保时"
    }
  ]
}
```

❌ **错误示例**：
```json
{
  "ageConditions": [
    {
      "limit": 51,
      "operator": ">=",  // 错误！这表示51周岁及以上承担责任
      "type": "投保时"
    }
  ]
}
```

**案例2：65周岁前不承担，65周岁后承担**

原文：
```
若被保险人于65周岁之后（含65周岁）...给付特别关爱金。
若被保险人于65周岁之前...不承担给付责任。
```

正确解析：
```json
{
  "ageConditions": [
    {
      "limit": 65,
      "operator": ">=",  // 65周岁及以上承担责任
      "type": "确诊时"
    }
  ]
}
```

#### 6.6.4 检查要点

解析完成后，必须检查：
1. ✅ 原文中是否有否定表述（"不承担"、"不给付"）
2. ✅ 如果有否定表述，年龄操作符是否正确反向
3. ✅ 避免同时标注正向和反向条件（如同时有 `< 30` 和 `>= 30`）

#### 6.6.5 年龄区间的简化

如果原文仅描述了**一个边界**（如"30周岁前给付"），则只需一个年龄条件：

✅ **正确**：
```json
{
  "ageConditions": [
    {
      "limit": 30,
      "operator": "<",
      "type": "确诊时"
    }
  ]
}
```

❌ **错误**（重复提取）：
```json
{
  "ageConditions": [
    {
      "limit": 30,
      "operator": "<",
      "type": "确诊时"
    },
    {
      "limit": 30,
      "operator": ">=",  // 多余！原文未提及30周岁后的情况
      "type": "确诊时"
    }
  ]
}
```

---

## 7. 保单年度范围规范

### 7.1 数据结构

```typescript
policyYearRange?: {
  start: number | null;  // 起始年度（null = 从第1年开始）
  end: number | null;    // 结束年度（null = 到保障结束）
}
```

### 7.2 end: null 的使用⭐️ 重要

**原则**: 当原文说"某年起"、"某周年日后"等没有明确结束时间时，使用 `null`

**示例**：

| 原文表述 | start | end | 说明 |
|---------|-------|-----|------|
| 第1-5保单年度 | `1` | `5` | 明确范围 |
| 第11保单年度起 | `11` | `null` | 到保障结束 |
| 第10个保单周年日后 | `11` | `null` | 第10个周年日是第11年开始 |

**与保单年度数的配合使用**：
```json
{
  "formula": "Min(基本保额 * 保单年度数, 基本保额 * 20)",
  "policyYearRange": {
    "start": 1,
    "end": null
  }
}
```

---

## 8. 交费期状态规范

### 8.1 字段定义

```typescript
paymentPeriodStatus?: 'during' | 'after';
```

- `during`: 缴费期内
- `after`: 缴费期满后

### 8.2 示例

```json
{
  "formula": "基本保额 * 交费年度数 * 105%",
  "paymentPeriodStatus": "during"
}
```

---

## 9. Note字段规范⭐️ 重要更新

### 9.1 字段位置

**✅ 正确位置**：案例级别（Case级别）

```json
{
  "序号": 109,
  "责任名称": "特定疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "formula": "基本保额 * 50%",
      "naturalLanguageDescription": "等待期后、18周岁前确诊，按基本保额的50%赔付"
    }
  ],
  "note": "给付以1次为限；需间隔180日"  // ✅ 在案例级别
}
```

**❌ 错误位置**：不要放在 PayoutTier（阶段）级别

```json
{
  "payoutAmount": [
    {
      "stageNumber": 1,
      "formula": "基本保额 * 50%",
      "note": "给付以1次为限"  // ❌ 错误！不应该在这里
    }
  ]
}
```

### 9.2 应该包含的内容（仅5类）

**核心原则**：只提取与赔付条件相关的核心信息，其他内容不要提取

| 序号 | 类型 | 示例 |
|-----|------|------|
| 1 | **赔付次数限制** | "给付以1次为限"<br>"累计最多赔3次"<br>"每种轻症限赔1次" |
| 2 | **间隔期要求** | "需间隔180日"<br>"需间隔1年"<br>"需间隔3年" |
| 3 | **分组规则** | "需属于不同组别"<br>"同组疾病限赔1次" |
| 4 | **豁免条件** | "豁免确诊后剩余保费"<br>"豁免后续应交保费" |
| 5 | **额外给付** | "额外给付"（仅此4字） |

#### 9.2.1 赔付次数限制的识别规则 ⭐️ 重要

**明确表述**（直接提取）：
- "给付以一次为限" → note: "给付以1次为限"
- "累计最多赔3次" → note: "累计最多赔3次"
- "每种轻症限赔1次；累计最多赔3次" → note: "每种轻症限赔1次；累计最多赔3次"

**终止表述**（需要推断）⭐️ 新增：

当原文包含以下表述时，**即使没有明确说"一次为限"，也应识别为赔付1次**：

| 原文表述 | 推断逻辑 | note内容 |
|---------|---------|---------|
| "给付...保险金，**本合同终止**" | 合同终止 = 只能赔1次 | "给付以1次为限" |
| "给付...保险金，**本项责任终止**" | 责任终止 = 只能赔1次 | "给付以1次为限" |
| "给付...保险金**责任终止**" | 责任终止 = 只能赔1次 | "给付以1次为限" |
| "按...给付...，**本合同终止**" | 合同终止 = 只能赔1次 | "给付以1次为限" |

**典型案例**：

✅ **案例1**：
```
原文：被保险人于等待期后...按本合同基本保险金额给付重大疾病保险金，本合同终止。
note: "给付以1次为限"
```

✅ **案例2**：
```
原文：我们按基本保额给付罕见疾病保险金，给付后罕见疾病保险金责任终止。
note: "给付以1次为限"
```

✅ **案例3**：
```
原文：按本合同已交保险费给付重大疾病保险金，本合同终止。
note: "给付以1次为限"
```

**为什么这样做？**
1. ✅ **提高数据完整性**：可将note覆盖率从55.6%提升到81.3%
2. ✅ **统一理解逻辑**："终止"暗示只能赔付一次
3. ✅ **便于后端处理**：确保每个案例都有赔付次数信息
4. ✅ **影响范围大**：约772个案例受益

### 9.3 不应该包含的内容（重要❌）

以下内容**不要**出现在note中：

| 不要提取的内容 | 原因 | 应该放在哪里 |
|--------------|------|------------|
| ❌ 等待期信息 | 已有 `waitingPeriodStatus` 字段 | waitingPeriodStatus |
| ❌ "因意外无等待期" | 已在 naturalLanguageDescription 体现 | naturalLanguageDescription |
| ❌ 年龄条件 | 已有 `ageConditions` 字段 | ageConditions |
| ❌ 保单年度 | 已有 `policyYearRange` 字段 | policyYearRange |
| ❌ 保额名称 | 已在责任名称中 | 责任名称 |
| ❌ 给付条件描述 | 过于冗长 | 责任原文 |
| ❌ "需同时满足XXX条件" | 过于冗长 | 责任原文 |
| ❌ "根据年龄段承担不同责任" | 已在阶段拆分体现 | 多个PayoutTier阶段 |
| ❌ "按XXX赔付" | 已在formula中 | formula |

**⚠️ 特别说明**："本合同终止"、"本项责任终止"**不是**直接放入note，而是应该**识别为赔付次数限制**，转换为"给付以1次为限"（见9.2.1节）

### 9.4 格式规范

多个note内容用 **中文分号（；）** 分隔：

```json
{
  "note": "每种轻症限赔1次；累计最多赔3次；需间隔90日"
}
```

### 9.5 实际案例对比

**❌ 错误示例**（序号109原版本）：
```json
{
  "payoutAmount": [
    {
      "stageNumber": 1,
      "note": "因意外无等待期；额外给付；需同时满足首次重大疾病保险金给付条件；根据年龄段承担不同的特定疾病保险责任；本项责任终止"
    }
  ]
}
```

**问题分析**：
1. note在错误的位置（应该在案例级别）
2. "因意外无等待期" - 无关，已在其他字段体现
3. "需同时满足首次重大疾病保险金给付条件" - 过于冗长
4. "根据年龄段承担不同的特定疾病保险责任" - 已在阶段拆分体现
5. "本项责任终止" - 无关信息

**✅ 正确示例**（修正后）：
```json
{
  "序号": 109,
  "责任名称": "特定疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 50%",
      "ageConditions": [{"type": "确诊时", "limit": 18, "operator": "<"}],
      "naturalLanguageDescription": "等待期后、18周岁前确诊，按基本保额的50%赔付"
    }
  ],
  "note": "给付以1次为限；额外给付"
}
```

---

## 10. 持续给付规范 ⭐️ 重要更新

### 10.1 什么是持续给付

**持续给付** 指一次确诊后，**自动触发**后续多次给付，不需要再次确诊或满足新条件。

### 10.2 两种结构方式 ⭐️ 重要

从v3.0开始，持续给付责任推荐使用**payoutStructure结构**（方案A），旧的continuousPayment方式已废弃。

#### 方案A：payoutStructure（推荐）⭐⭐⭐

**适用场景：** 一次确诊后有首次给付+后续持续给付的责任

**结构：**
```typescript
{
  "stageNumber": 2,
  "waitingPeriodStatus": "after",
  "payoutStructure": {
    "firstPayout": {
      "formula": "基本保额 * 1000%",
      "timing": "首次确诊"
    },
    "subsequentPayout": {
      "formula": "基本保额 * 200%",
      "frequency": "每年对应日"
    },
    "cumulativeLimit": {
      "formula": "基本保额 * 2000%"
    }
  },
  "naturalLanguageDescription": "等待期后确诊，首次给付10倍，后续每年给付2倍，累计封顶20倍"
}
```

**优势：**
- ✅ 业务语义清晰（首次、后续、封顶一目了然）
- ✅ 便于计算现金流（不需要跨阶段查找）
- ✅ 累计封顶直接关联（不需要includesStages）

**字段说明：**
- `firstPayout.formula`：首次给付公式（必填）
- `firstPayout.timing`：首次给付时机（可选，如"首次确诊"）
- `subsequentPayout.formula`：后续每次给付公式（必填）
- `subsequentPayout.frequency`：给付频率（必填，如"每年对应日"）
- `cumulativeLimit.formula`：累计给付封顶公式（必填）

**注意：**
- 使用payoutStructure时，**不需要**formula字段
- payoutStructure内部**不能有**note字段
- 所有说明都在naturalLanguageDescription中

#### 方案B：continuousPayment（已废弃）

旧的结构方式，仅用于理解历史数据：

```typescript
{
  "stageNumber": 3,
  "formula": "基本保额 * 200%",
  "continuousPayment": {
    "type": "until_termination",
    "frequency": "每年对应日",
    "cumulativeLimit": {
      "formula": "基本保额 * 2000%",
      "includesStages": [2, 3]
    }
  }
}
```

**问题：**
- ❌ 首次和后续分开为两个阶段，逻辑分散
- ❌ 需要includesStages来关联阶段
- ❌ 生成现金流需要跨阶段查找

---

### 10.3 LLM训练规则（payoutStructure）

**识别规则：**

当原文包含以下特征时，使用payoutStructure：
1. ✅ 明确提到"首次"+"后续"或"首次"+"每年"
2. ✅ 有累计限额（如"累计给付以...为限"）
3. ✅ 一次确诊后自动持续给付

**提取步骤：**

```
原文："首次给付基本保额的十倍，后续每年给付基本保额的二倍，累计给付以基本保额的二十倍为限"

第1步：识别为持续给付责任 → 使用payoutStructure

第2步：提取首次给付
→ firstPayout.formula = "基本保额 * 1000%"
→ firstPayout.timing = "首次确诊"

第3步：提取后续给付
→ subsequentPayout.formula = "基本保额 * 200%"
→ subsequentPayout.frequency = "每年对应日"

第4步：提取累计限额
→ cumulativeLimit.formula = "基本保额 * 2000%"

第5步：生成naturalLanguageDescription
→ "等待期后确诊，首次给付基本保额的1000%（10倍），后续每年在保单周年日给付基本保额的200%（2倍），累计给付以基本保额的2000%为限（20倍）"
```

**注意事项：**
- ❌ **不要拆分为两个阶段**（常见错误）
- ✅ 合并为一个阶段，使用payoutStructure
- ✅ payoutStructure内部不能有note字段
- ✅ 整个案例只有一个note（案例级别）

### 10.4 完整示例

#### 示例1：癌症持续给付（序号835）

```json
{
  "序号": 835,
  "责任名称": "癌症确诊保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "formula": "基本保额 * 10% + 已交保费",
      "waitingPeriodStatus": "during",
      "naturalLanguageDescription": "等待期内（1年内）确诊、按基本保额的10%加已交保费赔付"
    },
    {
      "stageNumber": 2,
      "waitingPeriodStatus": "after",
      "payoutStructure": {
        "firstPayout": {
          "formula": "基本保额 * 1000%",
          "timing": "首次确诊"
        },
        "subsequentPayout": {
          "formula": "基本保额 * 200%",
          "frequency": "每年对应日"
        },
        "cumulativeLimit": {
          "formula": "基本保额 * 2000%"
        }
      },
      "naturalLanguageDescription": "等待期后确诊，首次给付基本保额的1000%（10倍），后续每年在保单周年日给付基本保额的200%（2倍），累计给付以基本保额的2000%为限（20倍）；保险期间届满或身故时未达到20倍的，一次性给付剩余部分"
    }
  ],
  "note": "给付以1次为限"
}
```

**关键点：**
- ✅ 等待期内（阶段1）：普通formula
- ✅ 等待期后（阶段2）：使用payoutStructure
- ✅ 案例级别note：只记录确诊次数
- ✅ 无阶段级别note：所有说明在naturalLanguageDescription

**核心特征**：
- ✅ 一次确诊，自动多次给付
- ✅ 给付时间点固定（如每年对应日）
- ✅ 不需要再次满足疾病确诊条件

**非持续给付**（容易混淆）：
- ❌ 需要每次重新确诊不同组别疾病（如"第六次重度疾病保险金"）
- ❌ 需要满X年后再次确诊才给付（如"3年后再次确诊"）
- ❌ 需要满足新的条件（如"仍需持续治疗"）

---

### 10.2 字段结构（简化版）⭐️ 重要

```typescript
continuousPayment?: {
  type: 'fixed_count' | 'until_termination';  // 给付类型
  totalCount?: number;           // 总给付次数（仅fixed_count时需要）
  frequency: string;             // 给付频率（如"每年"、"每年对应日"）
}
```

**字段说明**：
- `type`: 给付类型（必填）
  - `fixed_count`: 固定次数给付（如分10次给付，无论合同是否终止）
  - `until_termination`: 直至合同终止（如每年都给付，直到身故或合同终止）
- `totalCount`: 总给付次数（仅type为`fixed_count`时需要）
  - 例如：分3次给付 → `totalCount: 3`
  - 分10次给付 → `totalCount: 10`
- `frequency`: 给付频率（必填）
  - 通常为"每年"或"每年对应日"
  - 如有特殊频率（如"每半年"），也在此字段体现

**设计原则**：
- ✅ 有 `continuousPayment` 对象 = 启用持续给付，无需单独的 `enabled` 字段
- ✅ 保留 `frequency` 明确给付频率，避免歧义
- ✅ 详细说明已在原文中，无需单独的 `description` 字段

---

### 10.3 使用场景

#### 场景1：固定次数持续给付（type: "fixed_count"）

**原文特征**：
- "分X次给付"
- "在确诊日、第2年对应日、第3年对应日分别给付"
- "分期给付，共X次"

**关键理解**：固定次数 = 无论合同是否终止，都按固定次数给付
- 例如：分10次给付，每年给付一次，10年后这项责任终止

**标注示例1**（序号1933 - 分3次给付）：
```json
{
  "stageNumber": 1,
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 30%",
  "continuousPayment": {
    "type": "fixed_count",
    "totalCount": 3,
    "frequency": "每年对应日"
  },
  "ageConditions": [
    {"type": "确诊时", "operator": ">=", "limit": 60}
  ],
  "naturalLanguageDescription": "等待期后、60周岁及以上确诊，每年按基本保额的30%赔付（分3次）"
}
```

**标注示例2**（序号3038 - 分3次给付，每次金额相同）：
```json
{
  "stageNumber": 1,
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 16.67%",
  "continuousPayment": {
    "type": "fixed_count",
    "totalCount": 3,
    "frequency": "每年对应日"
  },
  "ageConditions": [
    {"type": "确诊时", "operator": "<", "limit": 75}
  ],
  "naturalLanguageDescription": "等待期后、75周岁前确诊，每年按基本保额的16.67%赔付（分3次）"
}
```

**标注示例3**（假设：分10次给付）：
```json
{
  "stageNumber": 1,
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 20%",
  "continuousPayment": {
    "type": "fixed_count",
    "totalCount": 10,
    "frequency": "每年"
  },
  "naturalLanguageDescription": "等待期后确诊，每年按基本保额的20%赔付（分10次）"
}
```

---

#### 场景2：直至合同终止（type: "until_termination"）

**原文特征**：
- "之后每年在确诊对应日给付"
- "持续给付，直至合同终止"
- "每年给付，直至身故"

**关键理解**：直至终止 = 真正的没有次数上限，一直给到身故或合同终止

**标注示例1**（序号2785 - 并发症保险金）：
```json
{
  "stageNumber": 1,
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 20%",
  "continuousPayment": {
    "type": "until_termination",
    "frequency": "每年对应日"
  },
  "naturalLanguageDescription": "等待期后确诊，每年按基本保额的20%持续给付至合同终止"
}
```
> 原文：首次给付后，之后每年在确诊对应日持续给付，直至合同终止

**标注示例2**（假设：每年给付直到身故）：
```json
{
  "stageNumber": 1,
  "waitingPeriodStatus": "after",
  "formula": "基本保额 * 10%",
  "continuousPayment": {
    "type": "until_termination",
    "frequency": "每年"
  },
  "naturalLanguageDescription": "等待期后确诊，每年按基本保额的10%持续给付至身故"
}
```

---

### 10.4 与其他字段的配合

#### 1. frequency字段的重要性

**为什么保留frequency字段？**
- ✅ 明确给付频率，避免歧义
- ✅ 区分"fixed_count"持续10年 vs "until_termination"真正的无限期
- ✅ 为特殊频率（如"每半年"）预留空间

**常见frequency值**：
- "每年" - 最常见
- "每年对应日" - 强调在确诊对应日给付
- "每半年" - 特殊情况（较少见）

#### 2. 与note字段的关系

- **有continuousPayment字段**：note中不需要重复描述持续给付信息
- **无continuousPayment字段**：可在note中简单说明（如"满3年后再次确诊才给付"）

#### 3. 易混淆案例

**❌ 不是持续给付**（序号2275）：
```
原文：被保险人自第五次重度疾病确诊之日起满180日后，经医院确诊初次患前述五次重度疾病所属组别以外的其他组别中的一种或多种重度疾病，按照当年度保险金额给付第六次重度疾病保险金
```
**分析**：需要"第六次重新确诊"不同组别疾病，不是一次确诊后自动给付
**标注**：不使用continuousPayment字段

**✅ 是持续给付**（序号2785）：
```
原文：被保险人首次发生并被确诊为本合同列明的五类并发症，本公司按照保险金额的百分之二十给付并发症保险金；并在之后每年该确诊之日的对应日，本公司按照保险金额的百分之二十给付并发症保险金
```
**分析**：一次确诊后，每年对应日自动给付，无需再次确诊
**标注**：使用continuousPayment字段

#### 4. 每次金额不同的情况

当前方案假设每次给付金额相同。如果原文明确说明每次金额不同（如"第1次30%、第2次20%、第3次10%"），建议：
- **方案1（推荐）**：拆分为多个stage，每个stage一个金额
- **方案2**：在note中说明"首次X%，后续每次Y%"
- 未来可扩展为带schedule数组的复杂结构

---

### 10.5 naturalLanguageDescription 中的持续给付描述⭐️ 重要

**核心原则**：如果有 `continuousPayment` 字段，必须在 `naturalLanguageDescription` 中体现！

#### 描述模板

**固定次数（fixed_count）：**

| continuousPayment | naturalLanguageDescription示例 |
|------------------|------------------------------|
| `totalCount: 3` | "等待期后确诊，每年按基本保额的30%赔付**（分3次）**" |
| `totalCount: 10` | "等待期后、60周岁及以上，每年按基本保额的20%赔付**（分10次）**" |

**直至终止（until_termination）：**

| 原文表述 | naturalLanguageDescription示例 |
|---------|------------------------------|
| 直至合同终止 | "等待期后确诊，每年按基本保额的20%**持续给付至合同终止**" |
| 直至身故 | "等待期后确诊，每年按基本保额的10%**持续给付至身故**" |

#### 关键词选择

- **固定次数**：使用"分X次"或"共X次"
- **直至终止**：使用"持续给付至合同终止" / "持续给付至身故" / "持续给付至保障期满"

### 10.6 检查清单

持续给付案例必须检查：
- [ ] 确认是"一次确诊后自动多次给付"，不是"多次确诊"
- [ ] `type`值正确（`fixed_count`或`until_termination`）
- [ ] `fixed_count`类型必须有`totalCount`字段
- [ ] `frequency`必填（如"每年"、"每年对应日"）
- [ ] formula字段仍然存在且正确
- [ ] **naturalLanguageDescription必须包含持续给付信息**⭐️
- [ ] 不在note中重复持续给付信息

---

## 11. 复杂公式规范

### 10.1 Max() 函数 - 取最大值

**使用场景**：当原文说"按...中的**较大者**给付"、"取最大值"等

**常见表述**：
- "按基本保额、已交保费和现金价值的较大者给付"
- "按基本保额与已交保费的最大值给付"
- "按基本保额或现金价值（以较大者为准）给付"

**标注格式**：
```json
{
  "formula": "Max(基本保额, 已交保费, 现金价值)"
}
```

**示例1**：三者取最大
```json
{
  "period": "等待期后",
  "waitingPeriodStatus": "after",
  "formula": "Max(基本保额, 已交保费, 现金价值)",
  "note": "给付以一次为限"
}
```

**示例2**：两者取最大
```json
{
  "formula": "Max(基本保额, 已交保费)"
}
```

### 10.2 Min() 函数 - 取最小值（上限约束）

**使用场景**：当原文说"**不超过**"、"**最高不超过**"、"**以...为限**"等

**常见表述**：
- "按基本保额给付，但不超过基本保额的20倍"
- "按保单年度数递增，上限为基本保额的20倍"
- "最高不超过30万元"
- "当年度保险金额的数值上限以20倍基本保险金额为限"

**标注格式**：
```json
{
  "formula": "Min(基本保额 * 保单年度数, 基本保额 * 20)"
}
```

**示例1**：保单年度递增但有上限
```json
{
  "formula": "Min(基本保额 * 保单年度数, 基本保额 * 20)",
  "policyYearRange": {
    "start": 1,
    "end": null
  }
}
```

**示例2**：百分比给付但有上限
```json
{
  "formula": "Min(基本保额 * 保单年度数 * 20%, 基本保额 * 4)"
}
```

**示例3**：固定金额上限
```json
{
  "formula": "Min(基本保额, 300000)"
}
```

### 10.3 组合使用

**Max 和 Min 可以嵌套使用**：

```json
{
  "formula": "Max(Min(基本保额 * 保单年度数, 基本保额 * 20), 已交保费)"
}
```

### 10.4 注意事项

1. **函数名大写**：使用 `Max()` 和 `Min()`，不是 `max()` 或 `min()`
2. **参数分隔**：使用英文逗号 `,` 加空格
3. **括号匹配**：确保括号正确配对
4. **不要猜测**：如果原文没有明确说"较大者"或"不超过"，不要擅自添加 Max/Min

---

## 12. 完整示例

### 示例1：简单赔付
```json
{
  "序号": 1,
  "责任名称": "重大疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 100%",
      "naturalLanguageDescription": "等待期后确诊，按基本保额的100%赔付"
    }
  ],
  "note": "给付以1次为限"
}
```

### 示例2：等待期内外不同
```json
{
  "序号": 2,
  "责任名称": "轻症疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "during",
      "formula": "已交保费",
      "naturalLanguageDescription": "等待期内确诊，退还已交保费"
    },
    {
      "stageNumber": 2,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 30%",
      "naturalLanguageDescription": "等待期后确诊，按基本保额的30%赔付"
    }
  ],
  "note": "每种轻症限赔1次；累计最多赔3次"
}
```

### 示例3：保单年度递增
```json
{
  "序号": 2275,
  "责任名称": "第六次重度疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "Min(基本保额 * 保单年度数, 基本保额 * 20)",
      "policyYearRange": {
        "start": 1,
        "end": null
      },
      "naturalLanguageDescription": "等待期后、保单年度递增，按基本保额×保单年度数赔付（上限20倍）"
    }
  ],
  "note": "需间隔180日；需属于不同组别"
}
```

### 示例4：年龄条件
```json
{
  "序号": 3,
  "责任名称": "少儿特定疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 150%",
      "ageConditions": [
        {
          "limit": 18,
          "operator": "<",
          "type": "确诊时"
        }
      ],
      "naturalLanguageDescription": "等待期后、18周岁前确诊，按基本保额的150%赔付"
    }
  ],
  "note": "给付以1次为限"
}
```

### 示例5：占位术语（见下表）
```json
{
  "序号": 211,
  "责任名称": "首次重大疾病保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 年度给付比例",
      "formulaVariables": "年度给付比例根据保单年度确定，具体见合同附表",
      "policyYearRange": {
        "start": 1,
        "end": null
      },
      "naturalLanguageDescription": "等待期后、保单年度递增，按基本保额×年度给付比例赔付"
    }
  ]
}
```

### 示例6：持续给付（固定次数）
```json
{
  "序号": 1933,
  "责任名称": "重大疾病康复保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 30%",
      "ageConditions": [
        {
          "type": "确诊时",
          "limit": 60,
          "operator": ">="
        }
      ],
      "continuousPayment": {
        "type": "fixed_count",
        "totalCount": 3,
        "frequency": "每年对应日"
      },
      "naturalLanguageDescription": "等待期后、60周岁及以上确诊，每年按基本保额的30%赔付（分3次）"
    }
  ],
  "note": "额外给付；需间隔180日"
}
```
> 注意：naturalLanguageDescription包含了持续给付信息"分3次"

### 示例7：持续给付（直至终止）
```json
{
  "序号": 2785,
  "责任名称": "并发症保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 20%",
      "continuousPayment": {
        "type": "until_termination",
        "frequency": "每年对应日"
      },
      "naturalLanguageDescription": "等待期后确诊，每年按基本保额的20%持续给付至合同终止"
    }
  ]
}
```
> 注意：naturalLanguageDescription包含了持续给付信息"持续给付至合同终止"

### 示例8：男女年龄不同，赔付相同（共享阶段）⭐️
```json
{
  "序号": 1933,
  "责任名称": "重大疾病康复保险金",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "waitingPeriodStatus": "after",
      "formula": "基本保额 * 30%",
      "ageConditions": [
        {
          "type": "确诊时",
          "limit": 60,
          "operator": ">=",
          "gender": "男"
        },
        {
          "type": "确诊时",
          "limit": 55,
          "operator": ">=",
          "gender": "女"
        }
      ],
      "continuousPayment": {
        "type": "fixed_count",
        "totalCount": 3,
        "frequency": "每年对应日"
      },
      "naturalLanguageDescription": "等待期后、男性60周岁及以上或女性55周岁及以上确诊，每年按基本保额的30%赔付（分3次）"
    }
  ],
  "note": "额外给付；需间隔180日"
}
```
> 注意：
> 1. 原文说"男：60周岁，女：55周岁"，赔付金额相同（30%）
> 2. **共享1个阶段**，ageConditions包含2个条件
> 3. naturalLanguageDescription使用"或"连接："男性60周岁及以上**或**女性55周岁及以上"
> 4. 避免阶段爆炸（不拆分为2个阶段）

---

## 13. 质量检查清单 ⭐️ 新增

### 13.1 结构检查

- [ ] JSON格式正确，可正常解析
- [ ] 所有必填字段完整（序号、保单ID号、责任类型、责任名称、责任原文、payoutAmount）
- [ ] `payoutAmount` 数组不为空
- [ ] 每个阶段都有必填字段（stageNumber, waitingPeriodStatus, naturalLanguageDescription）
- [ ] 每个阶段有formula或payoutStructure（二选一）
- [ ] **note字段只在案例级别**，不在PayoutTier级别、不在policyYearRange内部⭐️
- [ ] **payoutStructure检查**（如有）：
  - [ ] 包含firstPayout、subsequentPayout、cumulativeLimit三个子字段
  - [ ] firstPayout.formula和subsequentPayout.formula都存在
  - [ ] subsequentPayout.frequency存在
  - [ ] cumulativeLimit.formula存在
  - [ ] payoutStructure内部无note字段

### 13.2 格式检查

- [ ] 所有公式符合规范格式（`基数 * 百分比` 或标准术语）
- [ ] 运算符统一使用 `*`（不使用 `×`）
- [ ] 保额术语正确（基本保额/有效保额/确诊当年度保额）
- [ ] 保费术语统一为"已交保费"（不是"退还已交保费"或"给付已交保费"）
- [ ] 双引号正确转义
- [ ] 使用中文术语，不使用字母变量（N/M/P/R）
- [ ] **每个stage都有naturalLanguageDescription**⭐️
- [ ] naturalLanguageDescription全面描述了该阶段的所有维度和公式⭐️

### 14.3 字段检查

- [ ] `stageNumber` 从1开始连续编号
- [ ] `waitingPeriodStatus` 只使用 `'during'` 或 `'after'`
- [ ] `ageConditions` 使用数组格式（不是单个对象）
- [ ] **年龄条件字段标准化**⭐️ 重要：
  - [ ] 使用 `limit` 字段（不是 `age`）
  - [ ] 使用 `type` 字段（不是 `ageType`）
  - [ ] `operator` 只使用 `<`, `>`, `<=`, `>=`（不使用 `range`）
  - [ ] `type` 只使用 `'投保时'` 或 `'确诊时'`
  - [ ] 原文区分男女年龄时，使用 `gender` 字段（`'男'` 或 `'女'`）⭐️ 新增
- [ ] `policyYearRange` 的 `start` 和 `end` 字段正确（使用null表示到保障结束）
- [ ] `formula` 字段不为空
- [ ] 使用占位术语时，必须有 `formulaVariables` 说明
- [ ] 不使用占位术语时，不应该有 `formulaVariables`
- [ ] **持续给付字段检查**⭐️ 重要：
  - [ ] 一次确诊后自动多次给付的案例，必须有 `continuousPayment` 字段
  - [ ] `type` 只使用 `'fixed_count'` 或 `'until_termination'`
  - [ ] `fixed_count` 类型必须有 `totalCount` 字段
  - [ ] `frequency` 必填（如"每年"、"每年对应日"）
  - [ ] 不在note中重复持续给付信息

### 13.4 内容检查

- [ ] **note字段检查**⭐️ 重要：
  - [ ] note在案例级别（Case级别），不在PayoutTier级别
  - [ ] note只包含5类内容：赔付次数、间隔期、分组规则、豁免条件、额外给付
  - [ ] note不包含：等待期、年龄条件、保单年度、给付条件描述、责任终止等
  - [ ] 多个note内容用中文分号（；）分隔
- [ ] **naturalLanguageDescription检查**⭐️ 重要：
  - [ ] 每个stage都有naturalLanguageDescription
  - [ ] 描述全面包含该阶段的所有维度（等待期、年龄、保单年度、**持续给付**等）
  - [ ] **有continuousPayment字段时，必须在描述中体现**（如"分3次" / "持续给付至合同终止"）
  - [ ] 描述清晰说明赔付公式
  - [ ] 描述简洁，不冗长
- [ ] 原文中的关键条件都已标注

### 13.5 逻辑检查

- [ ] 阶段拆分合理（等待期内外、不同年龄段、不同保单年度等）
- [ ] 等待期处理正确（默认为"等待期后"）
- [ ] 年龄条件逻辑正确（limit、operator、type正确配合）
- [ ] **年龄条件否定表述检查**⭐️ 重要：
  - [ ] 原文有"不承担责任"、"不给付"等否定表述时，年龄操作符是否正确反向
  - [ ] 如"X周岁后不承担"应为 `operator: "<"` （X周岁前承担）
  - [ ] 如"X周岁前不承担"应为 `operator: ">="` （X周岁及以上承担）
  - [ ] 避免重复提取年龄条件（如同时有 `< 30` 和 `>= 30`）
- [ ] 公式与原文一致
- [ ] Max/Min 函数使用正确：
  - [ ] "较大者" → 使用 `Max()`
  - [ ] "不超过"、"上限" → 使用 `Min()`
- [ ] 占位术语使用正确：
  - [ ] 原文说"见下表"但无具体数值 → 使用占位术语
  - [ ] 原文说"不高于X%"（上限） → 使用占位术语
  - [ ] 原文有具体百分比 → 不使用占位术语

### 13.6 完整性检查

- [ ] 多阶段案例的所有阶段都已标注
- [ ] 等待期内外都有赔付的案例，两个阶段都标注了
- [ ] 原文提到的所有条件都已结构化或记录在note中
- [ ] 特殊情况都有适当的说明（formulaVariables或note）

### 13.7 常见错误自查

| 错误类型 | 检查项 | 正确做法 |
|---------|--------|---------|
| 公式格式 | `基本保额` 缺少百分比 | 改为 `基本保额 * 100%` |
| 运算符 | 使用 `×` | 改为 `*` |
| 术语 | 使用"保险金额" | 改为"基本保额" |
| 术语 | 使用"退还已交保费" | 改为"已交保费" |
| 字母变量 | 使用 `基本保额 * N%` | 改为占位术语+formulaVariables |
| 字段名 | `ageCondition`（单数） | 改为 `ageConditions`（复数） |
| 上限 | 未使用Min函数 | `Min(实际值, 上限值)` |
| 占位术语 | 原文无具体比例却用了具体百分比 | 改为占位术语 |
| **年龄条件反向** ⭐️ | 原文"51周岁后不承担"却用 `>= 51` | 应为 `< 51`（51周岁前承担） |
| **年龄条件重复** | 同时有 `< 30` 和 `>= 30` | 删除多余条件，只保留原文明确的边界 |
| **年龄字段名错误** ⭐️ | 使用 `ageType` 或 `age` 字段 | 改为 `type` 和 `limit` |
| **年龄type错误** | 原文"确诊时"却标注为"投保时" | 根据原文准确标注 |
| **range操作符** | 使用 `operator: 'range'` | 拆分为两个独立条件 |

---

## 14. 常见错误与易错点 ⭐️ 新增

### 14.1 年龄条件相关错误

#### ❌ 错误1：年龄条件逻辑矛盾

**问题描述**：同一年龄同时有 `<` 和 `>=` 操作符

**错误示例**：
```json
{
  "ageConditions": [
    {"type": "确诊时", "limit": 60, "operator": "<"},
    {"type": "确诊时", "limit": 60, "operator": ">="}
  ]
}
```

**原因**：自动提取时产生重复或矛盾条件

**修复方法**：删除矛盾条件，只保留正确的一个

**实际案例**：批次14发现17个此类问题

---

#### ❌ 错误2：年龄条件缺失

**问题描述**：原文明确提到年龄，但解析结果中没有ageConditions字段

**修复方法**：仔细检查原文中的年龄表述，常见模式：未满X周岁、X周岁前、X周岁后、投保时年龄为X周岁等

**实际案例**：批次1-13发现43个此类问题

---

#### ❌ 错误3：type值标注错误（投保时 vs 确诊时）

**问题描述**：标注为"投保时"但原文没有"投保"关键词

**核心原则**：⭐️ **必须有明确的"投保"关键词才能标注为"投保时"**

**实际案例**：批次14发现59个此类问题

---

#### ❌ 错误4：使用旧字段格式

**问题描述**：使用已废弃的 `ageType`、`age` 字段

**正确格式**：使用 `type` 和 `limit`

**实际案例**：批次14发现148个此类问题

---

### 14.2 公式相关错误

#### ❌ 错误5："份数"未体现

**问题描述**：原文明确写"份数×金额"，但公式错误地使用"基本保额"

**正确标注**：
```json
{
  "formula": "份数 * 10000",
  "formulaVariables": "份数为投保份数，每份10000元人民币"
}
```

**检查要点**：原文出现"份数"关键词时，必须在公式中体现

**实际案例**：序号391, 2355, 2787

---

#### ❌ 错误6：增幅和限额未体现

**问题描述**：原文明确说明增幅规则和最高限额，但公式过于模糊

**正确标注**：
```json
{
  "formula": "基本保额 * Min(运动达标年度数 * 5%, 25%)",
  "formulaVariables": "运动达标年度数：第2-6保单年度内达到运动标准的年度数。第1年给付比例为0%，每达标一年增加5%，最高25%"
}
```

**核心原则**：
- 增幅必须在公式中明确（如 `* 5%`）
- 限额必须使用 Min() 或 Max() 函数体现

**实际案例**：序号2292

---

### 14.3 自检清单 ⭐️ 重要

解析完成后，**必须**检查以下项目：

**年龄条件检查**：
- [ ] 原文有年龄 → 解析结果必须有 ageConditions
- [ ] 标注"投保时" → 原文必须有"投保"关键词
- [ ] 同一年龄 → 不能同时有 < 和 >= 操作符
- [ ] 字段名 → 使用 type/limit，不使用 ageType/age
- [ ] 否定表述 → 操作符必须反向
- [ ] **原文区分男女年龄 → 添加gender字段；赔付相同时共享阶段，赔付不同时拆分阶段**⭐️ 新增

**公式检查**：
- [ ] 原文有"份数" → 公式必须使用"份数"变量
- [ ] 原文有增幅规则 → 公式必须体现增幅百分比
- [ ] 原文有最高限额 → 公式必须使用 Min() 函数
- [ ] 原文有最低保证 → 公式必须使用 Max() 函数
- [ ] 动态变量 → 必须有 formulaVariables 说明

**阶段拆分检查**：
- [ ] 不同年龄段不同赔付 → 必须拆分阶段
- [ ] 有"不赔付"情况 → 单独一个阶段，formula为"0"
- [ ] **赔付金额相同但合同状态不同 → 合并为一个阶段，在note中说明差异**⭐️ 新增

**持续给付检查**：
- [ ] 一次确诊后自动多次给付 → 必须有 continuousPayment 字段
- [ ] 分X次给付 → type为"fixed_count"，totalCount为具体次数
- [ ] 每年持续给付直至终止 → type为"until_termination"
- [ ] 需要多次重新确诊 → 不使用 continuousPayment

---

## 📌 更新历史

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2026-01-27 | **v3.0** | **重大更新：① 新增payoutStructure结构（方案A）用于持续给付责任，取代continuousPayment方式；② 明确"整个解析只有一个note"原则（案例级别），禁止阶段级别、policyYearRange等内部note；③ payoutStructure包含firstPayout、subsequentPayout、cumulativeLimit，语义清晰便于计算现金流；④ 完整示例（序号835）和LLM训练规则** ⭐️⭐️⭐️ |
| 2026-01-11 | **v2.9** | **重要更新：① 新增9.2.1节"赔付次数限制的识别规则"（从"本合同终止"/"责任终止"推断赔付1次，预期提升note覆盖率从55.6%到81.3%）；② 强化naturalLanguageDescription完整性要求（必须包含等待期、年龄、保单年度、交费期、持续给付等所有维度）；③ 明确中文百分比识别规范（"百分之二十"→20%）** ⭐️ |
| 2026-01-11 | v2.8 | 重要更新：① 简化continuousPayment结构（删除enabled和description，保留frequency）；② 新增naturalLanguageDescription必填字段（stage级别）；③ 明确note字段位置（案例级别）和内容要求（仅5类）；④ 新增gender字段支持男女年龄区分 |
| 2026-01-10 | v2.7 | 新增：第10章 持续给付规范；定义continuousPayment字段结构；区分固定次数和直至终止两种类型；提供详细使用场景和检查清单 |
| 2026-01-10 | v2.6 | 新增：第14章 常见错误与易错点；总结实践中发现的6类典型错误及修复方法 |
| 2026-01-10 | v2.5 | 新增：投保时vs确诊时核心判断原则 |
| 2026-01-10 | v2.1 | 补充：formulaVariables使用规范、已交保费统一规范、等待期默认值、复杂公式规范、质量检查清单 |
| 2026-01-10 | v2.0 | 统一三个规则文档；废弃字母变量；确认保留'during' |
| 2026-01-09 | v1.1 | 简化note字段；明确ageConditions数组 |
| 2026-01-08 | v1.0 | 初始版本 |

---

**文档结束**

