# æ•°æ®æµè½¬ç¤ºä¾‹

## åŽŸå§‹æ ‡æ³¨æ•°æ®ï¼ˆå½“å‰æ ¼å¼ï¼‰

```json
{
  "åºå·": 1,
  "ä¿å•IDå·": "å¤ªä¿å¯¿é™©[2023]ç–¾ç—…ä¿é™©005å·",
  "è´£ä»»ç±»åž‹": "é‡å¤§ç–¾ç—…ä¿é™©é‡‘",
  "è´£ä»»åç§°": "é‡å¤§ç–¾ç—…ä¿é™©é‡‘",
  "è´£ä»»åŽŸæ–‡": "åœ¨æœ¬åˆåŒä¿é™©æœŸé—´å†…ï¼Œè‹¥è¢«ä¿é™©äººäºŽç­‰å¾…æœŸåŽç»åŒ»é™¢é¦–æ¬¡ç¡®è¯Šåˆæ¬¡å‘ç”Ÿæœ¬åˆåŒæ‰€çº¦å®šçš„é‡å¤§ç–¾ç—…ï¼Œæˆ‘ä»¬æŒ‰æœ¬åˆåŒåŸºæœ¬ä¿é™©é‡‘é¢çš„100%ç»™ä»˜é‡å¤§ç–¾ç—…ä¿é™©é‡‘ï¼Œæœ¬åˆåŒç»ˆæ­¢ã€‚",
  "naturalLanguageDescription": "ç­‰å¾…æœŸåŽåˆæ¬¡ç¡®è¯Šé‡å¤§ç–¾ç—…ï¼Œèµ”ä»˜100%åŸºæœ¬ä¿é¢ï¼ŒåˆåŒç»ˆæ­¢",
  "payoutAmount": [
    {
      "stageNumber": 1,
      "period": "ç­‰å¾…æœŸåŽ",
      "waitingPeriodStatus": "after",
      "formula": "åŸºæœ¬ä¿é¢ * 100%",
      "note": "é¦–æ¬¡ç¡®è¯Šï¼›åˆåŒç»ˆæ­¢"
    }
  ]
}
```

---

## è½¬æ¢1ï¼šè®­ç»ƒæ•°æ®æ ¼å¼

**ç”¨é€”**ï¼šFine-tune å¤§æ¨¡åž‹

```jsonl
{"input": "åœ¨æœ¬åˆåŒä¿é™©æœŸé—´å†…ï¼Œè‹¥è¢«ä¿é™©äººäºŽç­‰å¾…æœŸåŽç»åŒ»é™¢é¦–æ¬¡ç¡®è¯Šåˆæ¬¡å‘ç”Ÿæœ¬åˆåŒæ‰€çº¦å®šçš„é‡å¤§ç–¾ç—…ï¼Œæˆ‘ä»¬æŒ‰æœ¬åˆåŒåŸºæœ¬ä¿é™©é‡‘é¢çš„100%ç»™ä»˜é‡å¤§ç–¾ç—…ä¿é™©é‡‘ï¼Œæœ¬åˆåŒç»ˆæ­¢ã€‚", "output": {"payoutAmount": [{"stageNumber": 1, "period": "ç­‰å¾…æœŸåŽ", "waitingPeriodStatus": "after", "formula": "åŸºæœ¬ä¿é¢ * 100%"}]}}
```

**å…³é”®å˜åŒ–**ï¼š
- âŒ ç§»é™¤äº† `note` å­—æ®µ
- âŒ ç§»é™¤äº† `naturalLanguageDescription`ï¼ˆå¯é€‰ï¼‰
- âŒ ç§»é™¤äº†å…ƒæ•°æ®ï¼ˆåºå·ã€ä¿å•IDç­‰ï¼‰
- âœ… ä¿ç•™äº†æ ¸å¿ƒçš„è¾“å…¥è¾“å‡ºå¯¹
- âœ… ä½¿ç”¨ JSONL æ ¼å¼ï¼ˆæ¯è¡Œä¸€ä¸ªæ ·æœ¬ï¼‰

---

## è½¬æ¢2ï¼šçŸ¥è¯†åº“æ•°æ®æ ¼å¼

**ç”¨é€”**ï¼šå­˜å…¥æ•°æ®åº“ï¼ˆPostgreSQL / Elasticsearchï¼‰

### å…³ç³»åž‹æ•°æ®åº“ï¼ˆPostgreSQLï¼‰

**è¡¨1ï¼špolicy_responsibilities**
```sql
id  | policy_id                        | responsibility_type | responsibility_name | original_text    | description                    | created_at
----|----------------------------------|---------------------|---------------------|------------------|--------------------------------|------------
1   | å¤ªä¿å¯¿é™©[2023]ç–¾ç—…ä¿é™©005å·       | é‡å¤§ç–¾ç—…ä¿é™©é‡‘      | é‡å¤§ç–¾ç—…ä¿é™©é‡‘      | åœ¨æœ¬åˆåŒä¿é™©...  | ç­‰å¾…æœŸåŽåˆæ¬¡ç¡®è¯Šé‡å¤§ç–¾ç—…...    | 2026-01-08
```

**è¡¨2ï¼špayout_stages**
```sql
id  | responsibility_id | stage_number | period     | waiting_period_status | formula          | formula_variables | note
----|-------------------|--------------|------------|-----------------------|------------------|-------------------|------
1   | 1                 | 1            | ç­‰å¾…æœŸåŽ   | after                 | åŸºæœ¬ä¿é¢ * 100%  | NULL              | é¦–æ¬¡ç¡®è¯Š...
```

**è¡¨3ï¼šage_conditions**ï¼ˆå¦‚æœ‰ï¼‰
```sql
id  | stage_id | age_limit | operator | age_type
----|----------|-----------|----------|----------
1   | 1        | 18        | >=       | ç¡®è¯Šæ—¶
2   | 1        | 61        | <        | ç¡®è¯Šæ—¶
```

### æœç´¢å¼•æ“Žï¼ˆElasticsearchï¼‰

```json
{
  "_index": "insurance_policies",
  "_id": "1",
  "_source": {
    "policy_id": "å¤ªä¿å¯¿é™©[2023]ç–¾ç—…ä¿é™©005å·",
    "company": "å¤ªä¿å¯¿é™©",
    "responsibility_type": "é‡å¤§ç–¾ç—…ä¿é™©é‡‘",
    "responsibility_name": "é‡å¤§ç–¾ç—…ä¿é™©é‡‘",
    "original_text": "åœ¨æœ¬åˆåŒä¿é™©æœŸé—´å†…ï¼Œè‹¥è¢«ä¿é™©äººäºŽç­‰å¾…æœŸåŽç»åŒ»é™¢é¦–æ¬¡ç¡®è¯Šåˆæ¬¡å‘ç”Ÿæœ¬åˆåŒæ‰€çº¦å®šçš„é‡å¤§ç–¾ç—…ï¼Œæˆ‘ä»¬æŒ‰æœ¬åˆåŒåŸºæœ¬ä¿é™©é‡‘é¢çš„100%ç»™ä»˜é‡å¤§ç–¾ç—…ä¿é™©é‡‘ï¼Œæœ¬åˆåŒç»ˆæ­¢ã€‚",
    "description": "ç­‰å¾…æœŸåŽåˆæ¬¡ç¡®è¯Šé‡å¤§ç–¾ç—…ï¼Œèµ”ä»˜100%åŸºæœ¬ä¿é¢ï¼ŒåˆåŒç»ˆæ­¢",
    "payout_amount": [
      {
        "stage_number": 1,
        "period": "ç­‰å¾…æœŸåŽ",
        "waiting_period_status": "after",
        "formula": "åŸºæœ¬ä¿é¢ * 100%"
      }
    ],
    "indexed_fields": {
      "has_age_condition": false,
      "stage_count": 1,
      "max_payout_ratio": 100
    }
  }
}
```

---

## è½¬æ¢3ï¼šåŽç«¯åº”ç”¨ï¼ˆç†èµ”è®¡ç®—ï¼‰

**ç”¨é€”**ï¼šç”¨æˆ·æŸ¥è¯¢ç†èµ”é‡‘é¢

### API è¯·æ±‚ç¤ºä¾‹

```json
POST /api/calculate-payout
{
  "policy_id": "å¤ªä¿å¯¿é™©[2023]ç–¾ç—…ä¿é™©005å·",
  "responsibility_name": "é‡å¤§ç–¾ç—…ä¿é™©é‡‘",
  "user_input": {
    "diagnosis_date": "2025-03-15",
    "birth_date": "1985-06-20",
    "policy_start_date": "2024-01-01",
    "base_amount": 500000
  }
}
```

### åŽç«¯å¤„ç†é€»è¾‘

```python
# 1. ä»ŽçŸ¥è¯†åº“æŸ¥è¯¢è´£ä»»æ•°æ®
responsibility = db.query(policy_id, responsibility_name)

# 2. éåŽ†æ‰€æœ‰é˜¶æ®µï¼ŒåŒ¹é…æ¡ä»¶
for stage in responsibility.payout_amount:
    # æ£€æŸ¥ç­‰å¾…æœŸ
    if not check_waiting_period(stage, user_input):
        continue
    
    # æ£€æŸ¥å¹´é¾„æ¡ä»¶
    if stage.age_conditions:
        if not check_age_conditions(stage.age_conditions, user_input):
            continue
    
    # æ£€æŸ¥ä¿å•å¹´åº¦
    if stage.policy_year_range:
        if not check_policy_year(stage.policy_year_range, user_input):
            continue
    
    # åŒ¹é…æˆåŠŸï¼Œè®¡ç®—ç†èµ”é‡‘é¢
    amount = calculate_formula(stage.formula, user_input.base_amount)
    return {
        "matched_stage": stage,
        "payout_amount": amount,
        "calculation_details": f"{stage.formula} = {amount}"
    }
```

### API å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "matched_stage": {
    "stage_number": 1,
    "period": "ç­‰å¾…æœŸåŽ",
    "formula": "åŸºæœ¬ä¿é¢ * 100%"
  },
  "payout_amount": 500000,
  "calculation_details": "åŸºæœ¬ä¿é¢ * 100% = 500,000 * 100% = 500,000å…ƒ",
  "note": "é¦–æ¬¡ç¡®è¯Šï¼›åˆåŒç»ˆæ­¢"
}
```

---

## å…³é”®æ€»ç»“

| é˜¶æ®µ | æ•°æ®æ ¼å¼ | å…³é”®å˜åŒ– | ä¿ç•™å­—æ®µ |
|------|----------|----------|----------|
| **æ ‡æ³¨** | å®Œæ•´JSON | åŒ…å«æ‰€æœ‰å­—æ®µ | å…¨éƒ¨ |
| **è®­ç»ƒ** | JSONL | ç§»é™¤noteã€å…ƒæ•°æ® | æ ¸å¿ƒè¾“å…¥è¾“å‡º |
| **çŸ¥è¯†åº“** | æ•°æ®åº“/ES | å»ºç«‹ç´¢å¼•ã€å…³è”è¡¨ | å…¨éƒ¨ï¼ˆå¯æŸ¥è¯¢ï¼‰ |
| **åº”ç”¨** | APIè°ƒç”¨ | å®žæ—¶è®¡ç®— | æŒ‰éœ€æŸ¥è¯¢ |

---

## ä¸€æ¬¡æ ‡æ³¨ï¼Œå¤šå¤„ä½¿ç”¨ âœ…

```
æ ‡æ³¨æ•°æ®ï¼ˆ200ä¸ªæ¡ˆä¾‹ï¼‰
    â†“
    â”œâ”€â†’ [è®­ç»ƒ] ç§»é™¤note â†’ Fine-tuneæ¨¡åž‹ â†’ è‡ªåŠ¨è§£æžæ–°ä¿å•
    â”œâ”€â†’ [çŸ¥è¯†åº“] å»ºç«‹ç´¢å¼• â†’ ç”¨æˆ·æŸ¥è¯¢ â†’ å¿«é€Ÿæ£€ç´¢
    â””â”€â†’ [åŽç«¯] å®žæ—¶è®¡ç®— â†’ ç†èµ”å¼•æ“Ž â†’ ç²¾å‡†è®¡ç®—
```

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“å‰æ ¼å¼å¦‚æ­¤é‡è¦â€”â€”å®ƒæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®åŸºç¡€ï¼** ðŸŽ¯

